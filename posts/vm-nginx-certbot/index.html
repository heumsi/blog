<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta data-rh="true" property="keywords" content="Infra,GCP,Nginx,Certbot,HTTPS"/><meta data-rh="true" property="og:image" content="/blog/static/d4e93b48968d656f419589025bf51176/bc336/thumbnail.png"/><meta data-rh="true" property="og:description" content="Nginx와 Certbot을 이용한 HTTPS 적용 과정"/><meta data-rh="true" property="og:title" content="IP를 벗어나 서브 도메인 적용하기"/><meta data-rh="true" property="og:url" content="https://heumsi.github.io/blog/posts/vm-nginx-certbot/"/><meta data-rh="true" name="description" content="Nginx와 Certbot을 이용한 HTTPS 적용 과정"/><meta data-rh="true" name="googlebot" content="index,follow"/><meta data-rh="true" name="robots" content="index,follow"/><meta data-rh="true" property="og:site_name" content="하나씩. 점을. 찍어나가며."/><meta data-rh="true" property="og:type" content="website"/><meta data-rh="true" name="twitter:creator" content="@handle"/><meta data-rh="true" name="twitter:site" content="@site"/><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta name="generator" content="Gatsby 4.17.2"/><style data-href="/blog/styles.202b843a3255cda52de9.css" data-identity="gatsby-global-css">/*! minireset.css v0.0.7 | MIT License | github.com/jgthms/minireset.css */blockquote,body,dd,dl,dt,fieldset,figure,h1,h2,h3,h4,h5,h6,hr,html,iframe,legend,li,ol,p,pre,textarea,ul{margin:0;padding:0}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:400}ul{list-style:none}button,input,select{margin:0}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}img,video{height:auto;max-width:100%}iframe{border:0}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}code[class*=language-],pre[class*=language-]{background:#fafafa;color:#383a42;direction:ltr;font-family:Fira Code,Fira Mono,Menlo,Consolas,DejaVu Sans Mono,monospace;font-size:.95em;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#e5e5e6;color:inherit}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection{background:#e5e5e6;color:inherit}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.2em .3em;white-space:normal}.token.cdata,.token.comment,.token.prolog{color:#a0a1a7}.token.doctype,.token.entity,.token.punctuation{color:#383a42}.token.atrule,.token.attr-name,.token.boolean,.token.class-name,.token.constant,.token.number{color:#b76b01}.token.keyword{color:#a626a4}.token.deleted,.token.important,.token.property,.token.symbol,.token.tag{color:#e45649}.token.attr-value,.token.attr-value>.token.punctuation,.token.builtin,.token.char,.token.inserted,.token.regex,.token.selector,.token.string{color:#50a14f}.token.function,.token.operator,.token.variable{color:#4078f2}.token.url{color:#0184bc}.token.attr-value>.token.punctuation.attr-equals,.token.special-attr>.token.attr-value>.token.value.css{color:#383a42}.language-css .token.selector{color:#e45649}.language-css .token.property{color:#383a42}.language-css .token.function,.language-css .token.url>.token.function{color:#0184bc}.language-css .token.url>.token.string.url{color:#50a14f}.language-css .token.atrule .token.rule,.language-css .token.important,.language-javascript .token.operator{color:#a626a4}.language-javascript .token.template-string>.token.interpolation>.token.interpolation-punctuation.punctuation{color:#ca1243}.language-json .token.operator{color:#383a42}.language-json .token.null.keyword{color:#b76b01}.language-markdown .token.url,.language-markdown .token.url-reference.url>.token.string,.language-markdown .token.url>.token.operator{color:#383a42}.language-markdown .token.url>.token.content{color:#4078f2}.language-markdown .token.url-reference.url,.language-markdown .token.url>.token.url{color:#0184bc}.language-markdown .token.blockquote.punctuation,.language-markdown .token.hr.punctuation{color:#a0a1a7;font-style:italic}.language-markdown .token.code-snippet{color:#50a14f}.language-markdown .token.bold .token.content{color:#b76b01}.language-markdown .token.italic .token.content{color:#a626a4}.language-markdown .token.list.punctuation,.language-markdown .token.strike .token.content,.language-markdown .token.strike .token.punctuation,.language-markdown .token.title.important>.token.punctuation{color:#e45649}.token.bold{font-weight:700}.token.comment,.token.italic{font-style:italic}.token.entity{cursor:help}.token.namespace{opacity:.8}.token.token.cr:before,.token.token.lf:before,.token.token.space:before,.token.token.tab:not(:empty):before{color:rgba(56,58,66,.2)}div.code-toolbar>.toolbar.toolbar>.toolbar-item{margin-right:.4em}div.code-toolbar>.toolbar.toolbar>.toolbar-item>a,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span{background:#e5e5e6;border-radius:.3em;color:#696c77;padding:.1em .4em}div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:hover{background:#c6c7c7;color:#383a42}.line-highlight.line-highlight{background:rgba(56,58,66,.05)}.line-highlight.line-highlight:before,.line-highlight.line-highlight[data-end]:after{background:#e5e5e6;border-radius:.3em;box-shadow:0 2px 0 0 rgba(0,0,0,.2);color:#383a42;padding:.1em .6em}pre[id].linkable-line-numbers.linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:rgba(56,58,66,.05)}.command-line .command-line-prompt,.line-numbers.line-numbers .line-numbers-rows{border-right-color:rgba(56,58,66,.2)}.command-line .command-line-prompt>span:before,.line-numbers .line-numbers-rows>span:before{color:#9d9d9f}.rainbow-braces .token.token.punctuation.brace-level-1,.rainbow-braces .token.token.punctuation.brace-level-5,.rainbow-braces .token.token.punctuation.brace-level-9{color:#e45649}.rainbow-braces .token.token.punctuation.brace-level-10,.rainbow-braces .token.token.punctuation.brace-level-2,.rainbow-braces .token.token.punctuation.brace-level-6{color:#50a14f}.rainbow-braces .token.token.punctuation.brace-level-11,.rainbow-braces .token.token.punctuation.brace-level-3,.rainbow-braces .token.token.punctuation.brace-level-7{color:#4078f2}.rainbow-braces .token.token.punctuation.brace-level-12,.rainbow-braces .token.token.punctuation.brace-level-4,.rainbow-braces .token.token.punctuation.brace-level-8{color:#a626a4}pre.diff-highlight>code .token.token.deleted:not(.prefix),pre>code.diff-highlight .token.token.deleted:not(.prefix){background-color:rgba(255,82,102,.15)}pre.diff-highlight>code .token.token.deleted:not(.prefix) ::-moz-selection,pre.diff-highlight>code .token.token.deleted:not(.prefix)::-moz-selection,pre>code.diff-highlight .token.token.deleted:not(.prefix) ::-moz-selection,pre>code.diff-highlight .token.token.deleted:not(.prefix)::-moz-selection{background-color:rgba(251,86,105,.25)}pre.diff-highlight>code .token.token.deleted:not(.prefix) ::selection,pre.diff-highlight>code .token.token.deleted:not(.prefix)::selection,pre>code.diff-highlight .token.token.deleted:not(.prefix) ::selection,pre>code.diff-highlight .token.token.deleted:not(.prefix)::selection{background-color:rgba(251,86,105,.25)}pre.diff-highlight>code .token.token.inserted:not(.prefix),pre>code.diff-highlight .token.token.inserted:not(.prefix){background-color:rgba(25,255,91,.15)}pre.diff-highlight>code .token.token.inserted:not(.prefix) ::-moz-selection,pre.diff-highlight>code .token.token.inserted:not(.prefix)::-moz-selection,pre>code.diff-highlight .token.token.inserted:not(.prefix) ::-moz-selection,pre>code.diff-highlight .token.token.inserted:not(.prefix)::-moz-selection{background-color:rgba(56,224,98,.25)}pre.diff-highlight>code .token.token.inserted:not(.prefix) ::selection,pre.diff-highlight>code .token.token.inserted:not(.prefix)::selection,pre>code.diff-highlight .token.token.inserted:not(.prefix) ::selection,pre>code.diff-highlight .token.token.inserted:not(.prefix)::selection{background-color:rgba(56,224,98,.25)}.prism-previewer-gradient.prism-previewer-gradient div,.prism-previewer.prism-previewer:before{border-color:hsl(0,0,95%)}.prism-previewer-color.prism-previewer-color:before,.prism-previewer-easing.prism-previewer-easing:before,.prism-previewer-gradient.prism-previewer-gradient div{border-radius:.3em}.prism-previewer.prism-previewer:after{border-top-color:hsl(0,0,95%)}.prism-previewer-flipped.prism-previewer-flipped.after{border-bottom-color:hsl(0,0,95%)}.prism-previewer-angle.prism-previewer-angle:before,.prism-previewer-easing.prism-previewer-easing,.prism-previewer-time.prism-previewer-time:before{background:#fff}.prism-previewer-angle.prism-previewer-angle circle,.prism-previewer-time.prism-previewer-time circle{stroke:#383a42;stroke-opacity:1}.prism-previewer-easing.prism-previewer-easing circle,.prism-previewer-easing.prism-previewer-easing line,.prism-previewer-easing.prism-previewer-easing path{stroke:#383a42}.prism-previewer-easing.prism-previewer-easing circle{fill:transparent}.gatsby-highlight-code-line{background-color:#eee;display:block;margin-left:-1em;margin-right:-1em;padding-left:1em;padding-right:1em}.gatsby-highlight{background:#fafafa;margin:0 0 1em;overflow:auto;padding:1em}.gatsby-highlight pre[class*=language-]{background-color:transparent;float:left;margin:0;min-width:100%;overflow:initial;padding:0}.toc{overflow-y:auto}.toc>.toc-list{overflow:hidden;position:relative}.toc>.toc-list li{list-style:none}.toc-list{margin:0;padding-left:10px}a.toc-link{color:currentColor;height:100%}.is-collapsible{max-height:1000px;overflow:hidden;transition:all .3s ease-in-out}.is-collapsed{max-height:0}.is-position-fixed{position:fixed!important;top:0}.is-active-link{font-weight:700}.toc-link:before{background-color:#eee;content:" ";display:inline-block;height:inherit;left:0;margin-top:-1px;position:absolute;width:2px}.is-active-link:before{background-color:#54bc4b}.toc{color:#333;font-size:.8em;left:0;line-height:1.8em;max-width:20rem;padding-left:1rem;position:fixed;top:50vh;transform:translateY(-50%);transition:all .4s cubic-bezier(.25,.8,.4,.95);visibility:visible;width:100%}.toc-list-item{font-weight:300}.is-active-link{font-weight:400}.toc-hidden{transform:translate(-100%,-50%);visibility:hidden}.toc-link:before{background-color:inherit}@media only screen and (max-width:85rem){.toc{visibility:hidden}}*{color:inherit;text-decoration:none}body{-ms-text-size-adjust:100%;-moz-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#333;font-size:1rem;word-break:break-all}h1{font-size:2.441em}h1,h2{font-weight:700}h2{font-size:1.953em}h3{font-size:1.563em}h3,h4{font-weight:700}h4{font-size:1.25em}li,p{font-size:1em;font-weight:400;line-height:1.8em}a{cursor:pointer}.container{font-family:sans-serif;margin:auto;max-width:45rem;width:100%}header{align-items:center;display:flex;justify-content:space-between;margin:1.5rem 0 1rem}header .site-title{font-weight:700;margin:0;transition:.33s}header .site-title:hover{color:#344cb7}header nav{display:flex;font-weight:400}header nav .nav-item a{padding-right:1.5rem;transition:.33s}header nav .nav-item a:hover{color:#344cb7}header nav .nav-item a:last-child{padding-right:0}.content .page-title{font-weight:500}.content .post-item{align-items:center;list-style:none;margin:2rem 0;transition:.33s}.content .post-item:hover{color:#344cb7}.content .post-item a{text-decoration:none}.content .post-item article{display:flex}.content .post-item-thumbnail{height:7rem;width:7rem}.content .post-item-desc{display:flex;flex-direction:column;height:7rem;margin-left:1.5rem}.content .post-item-title{font-weight:400;margin-top:0}.content .post-item-sub-title{line-height:1.4em;margin-top:.5rem}.content .post-item-meta{color:#666;font-size:.9em;line-height:1em;margin:auto 0 0}.content .post-cover-image{height:400px;left:50%;margin-bottom:2rem;margin-left:-50vw;margin-right:-50vw;max-width:100vw;position:relative;right:50%;width:100vw}.content .post-sub-title{color:#666;font-weight:400;margin-top:1rem}.content .post-meta{color:#666;display:block;margin-top:.5rem}.content .post-content{margin:3rem 0 5rem}.content .log-content{margin-top:1rem}.content .post-content h2,h3,h4{margin-top:2em}.content .post-content p{margin:1em 0}.content .post-content hr{background-color:#eee;border:0;height:1px;margin:2em}.content .post-content table{overflow-x:auto;width:100%}.content .post-content table th{background-color:#fafafa}.content .post-content table th,td{border:1px solid #ccc;padding:.5em}.content .log-content a,.content .post-content a{text-decoration:underline}.content .post-content>ul{margin:1em 0}.content .log-content ul li,.content .post-content ul li{list-style:outside;margin-left:1em}.content .log-content ul li p,.content .post-content ul li p{margin:0}.content .log-content ol li,.content .post-content ol li{margin-left:1em}.content .post-content .gatsby-resp-image-wrapper{margin:2em 0}.content .log-content .gatsby-resp-image-wrapper{margin:1em 0;margin-left:0!important;margin-right:0!important;max-width:100%!important}.content .log-content .gatsby-resp-image-wrapper+em,.content .post-content .gatsby-resp-image-wrapper+em{color:#999;display:block;font-size:.9em;font-style:normal;line-height:1.5em;margin:-1.5em auto 2em;max-width:90%;text-align:center}.content .log-content blockquote,.content .post-content blockquote{background:#f6f6f6;border-left:4px solid #e6e6e6;color:#666;margin:1rem 0;padding:1rem}.content .log-content blockquote code,.content .post-content blockquote code{color:#666}.content .log-content blockquote ol,.content .log-content blockquote p,.content .log-content blockquote ul,.content .post-content blockquote ol,.content .post-content blockquote p,.content .post-content blockquote ul{margin:1em 0}.content .log-content blockquote p:first-child,.content .log-content blockquote p:last-child,.content .post-content blockquote p:first-child,.content .post-content blockquote p:last-child{margin:0}.content .post-content .mermaid{margin:0 auto;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.content .log-item{line-height:1.8em;margin:2rem 0}.content .log-title span{cursor:pointer;font-size:.6em;margin-left:.6em;opacity:.6;transition:.33s}.content .log-title span:hover{opacity:1}.content .log-content a{text-decoration:underline}.content .log-datetime{color:#666;font-size:.9em}footer{align-items:center;color:#666;display:flex;justify-content:space-between;margin:3rem 0}footer .external-links li{display:inline-block;margin:0 .5rem;transition:.33s}footer .external-links li:hover{color:#344cb7}footer .copy-right{font-size:.9rem;text-align:right}@media screen and (max-width:800px){html{font-size:1rem}h1{font-size:1.749em}h1,h2{font-weight:700}h2{font-size:1.521em}h3{font-size:1.322em}h3,h4{font-weight:700}h4{font-size:1.15em}.container{padding:0 1rem}header .site-title{font-size:1rem}header nav .nav-item a{padding-right:1rem}.content .post-list .post-item{border-bottom:1px solid #ccc;margin:0 -1rem;padding:1rem}.content .post-list .post-item:last-child{border-bottom:none}.content .post-list .post-item a{text-decoration:none}.content .post-cover-image{margin-bottom:1.5rem}.content .page-title{font-size:1rem}.content .post-item-title{font-size:1.2rem}.content .post-item-thumbnail{display:none!important}.content .post-item-desc{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;margin-left:0}.content .post-item-meta{line-height:1.4em}footer{margin:1rem 0}}</style><link rel="preconnect" href="https://plausible.io"/><script async="" defer="" data-domain="heumsi.github.io/blog" src="https://plausible.io/js/plausible.js"></script><script>
          window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) };
          
          </script><title data-rh="true">IP를 벗어나 서브 도메인 적용하기</title><link data-rh="true" rel="canonical" href="https://heumsi.github.io/blog/posts/vm-nginx-certbot/"/><script data-rh="true" defer="" src="https://cloud.umami.is/script.js" data-website-id="c247e343-b8cb-4751-8e13-8e8557a94875"></script><link rel="sitemap" type="application/xml" href="/blog/sitemap/sitemap-index.xml"/><link rel="alternate" type="application/rss+xml" title="하나씩 점을 찍어나가며 - Heumsi의 블로그 RSS" href="/blog/rss.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZRH97WV1XY"></script><script>
    window.GATSBY_GTAG_PLUGIN_GA_TRACKING_ID = (
      'G-ZRH97WV1XY'
    );
    window.GATSBY_GTAG_PLUGIN_ANONYMIZE = false;

    var options = {
      send_page_view: false
    };
    if (false) {
      options.anonymize_ip = true;
    }

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    window.gtag = gtag;
    gtag('js', new Date());
    gtag('config', 'G-ZRH97WV1XY', options);
  </script><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="container"><header><h3 class="site-title"><a href="/blog/">하나씩. 점을. 찍어나가며.</a></h3><nav><ul><li class="nav-item"><a class="nav-link-text" href="/blog/posts">글</a><a class="nav-link-text" href="/blog/logs">로그</a></li></ul></nav></header><main class="content"><section class="post-cover-image gbi-68686773-jUzXrNn3FcP1Ko9BeM4xiD" style="background-position:center;background-repeat:no-repeat;background-size:cover;position:relative"><style>
          .post-cover-image.gbi-68686773-jUzXrNn3FcP1Ko9BeM4xiD:before,
          .post-cover-image.gbi-68686773-jUzXrNn3FcP1Ko9BeM4xiD:after {
            content: '';
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            
            transition: opacity 0.5s ease 250ms;
            background-position: center;
background-repeat: no-repeat;
background-size: cover;

          }
          .post-cover-image.gbi-68686773-jUzXrNn3FcP1Ko9BeM4xiD:before {
            z-index: -100;
            
            
            opacity: 1; 
          }
          .post-cover-image.gbi-68686773-jUzXrNn3FcP1Ko9BeM4xiD:after {
            z-index: -101;
            
            
            
          }
        </style><noscript><style>
    .post-cover-image.gbi-68686773-jUzXrNn3FcP1Ko9BeM4xiD:before {
      opacity: 1;
      background-image: url('/blog/static/d4e93b48968d656f419589025bf51176/bc336/thumbnail.png');
    }</style></noscript></section><h1 class="post-title">IP를 벗어나 서브 도메인 적용하기</h1><h3 class="post-sub-title">Nginx와 Certbot을 이용한 HTTPS 적용 과정</h3><p class="post-meta"><span>2024년 3월 3일</span> — <span>Infra<!-- -->, <!-- -->GCP<!-- -->, <!-- -->Nginx<!-- -->, <!-- -->Certbot<!-- -->, <!-- -->HTTPS</span></p><div class="toc toc-hidden"></div><div class="post-content"><p>최근에 GCP VM에서 IP로 접속하던 서비스들을 서브 도메인으로 바꾸고 HTTPS 설정한 과정에 대해 기록해둔다.</p><h2 id="배경" style="position:relative"><a href="#%EB%B0%B0%EA%B2%BD" aria-label="배경 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>배경</h2><p>나는 GCP에서 <a href="https://cloud.google.com/products/compute?hl=ko">VM(GCE)</a>를 하나 띄워 둔 후, 여기에 이런저런 서비스들을 다음처럼 도커로 배포해서 사용하고 있었다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">docker</span> <span class="token function">ps</span>

CONTAINER ID   IMAGE                             COMMAND                  CREATED        STATUS                  PORTS                                       NAMES
64f1b7650b5e   notebook:latest                   <span class="token string">&quot;tini -g -- start.sh…&quot;</span>   <span class="token number">3</span> days ago     Up <span class="token number">3</span> days <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>     <span class="token number">8888</span>/tcp                                    jupyter-hyeonwoo-2echeon03
ada70c59cabd   jupyterhub                        <span class="token string">&quot;jupyterhub -f /srv/…&quot;</span>   <span class="token number">3</span> days ago     Up <span class="token number">3</span> days               <span class="token number">0.0</span>.0.0:8000-<span class="token operator">&gt;</span><span class="token number">8000</span>/tcp, :::8000-<span class="token operator">&gt;</span><span class="token number">8000</span>/tcp   jupyterhub
65370b9f3659   louislam/uptime-kuma:1            <span class="token string">&quot;/usr/bin/dumb-init …&quot;</span>   <span class="token number">9</span> days ago     Up <span class="token number">9</span> days <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>     <span class="token number">0.0</span>.0.0:3001-<span class="token operator">&gt;</span><span class="token number">3001</span>/tcp, :::3001-<span class="token operator">&gt;</span><span class="token number">3001</span>/tcp   uptime-kuma
a77ca2560ebe   apache/airflow:2.8.0-python3.10   <span class="token string">&quot;/usr/bin/dumb-init …&quot;</span>   <span class="token number">5</span> weeks ago    Up <span class="token number">5</span> weeks <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>    <span class="token number">0.0</span>.0.0:8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, :::8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp   airflow-airflow-webserver-1
aaab37ca1c23   apache/airflow:2.8.0-python3.10   <span class="token string">&quot;/usr/bin/dumb-init …&quot;</span>   <span class="token number">5</span> weeks ago    Up <span class="token number">5</span> weeks <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>    <span class="token number">8080</span>/tcp                                    airflow-airflow-scheduler-1
98aadb5bb4b2   postgres:13                       <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">2</span> months ago   Up <span class="token number">2</span> months <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   <span class="token number">5432</span>/tcp                                    airflow-postgres-1
d32b43a154a7   linuxserver/code-server:4.20.0    <span class="token string">&quot;/init&quot;</span>                  <span class="token number">2</span> months ago   Up <span class="token number">2</span> months             <span class="token number">0.0</span>.0.0:8443-<span class="token operator">&gt;</span><span class="token number">8443</span>/tcp, :::8443-<span class="token operator">&gt;</span><span class="token number">8443</span>/tcp   stoic_spence</code></pre></div><p>보면 알겠지만, 대부분 데이터 팀에서 사용할 법한 서비스들이다.</p><p>서비스 접속은 <code class="language-text">https://123.123.123.123:8080</code> 와 같이 IP와 포트를 이용했다.
도메인 쓰려면 돈 내야했기 때문에, 일단 고정 IP만 VM에 붙이고, 방화벽에서 서비스가 사용하는 포트만 열어두었다.</p><p>이 서비스에 접근하는 사람이 처음엔 나 뿐이 었는데, 이제는 다른 사람들(개발자 아님)도 접속하게 되었다.
그들이 IP로 접속하는건... 좀 그렇기도 하고, 사실 무엇보다 내가 브라우저에서 IP 뭐더라하고 있는게 너무 귀찮아서, 이제 도메인을 도입해야할 때가 왔다고 생각이 들었다.</p><h2 id="목표" style="position:relative"><a href="#%EB%AA%A9%ED%91%9C" aria-label="목표 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>목표</h2><p>작업 목표 2개 였다.</p><ol><li>도메인 사서 서비스 별로 서브 도메인 적용하자. (ex. <code class="language-text">uptime.my-domain.com</code>)</li><li>HTTPS도 적용하자.</li></ol><p>다음과 같은 구조가 적용될 것이다.</p><div class="mermaid" data-processed="true"><svg viewBox="0 0 1002.984375 300" style="max-width:1002.984375px" height="300" aria-labelled-by="chart-title-mermaid-1736145203859,chart-desc-mermaid-1736145203859" role="img" xmlnsXLink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1736145203859"><title id="chart-title-mermaid-1736145203859"></title><desc id="chart-desc-mermaid-1736145203859"></desc><style>#mermaid-1736145203859 {font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1736145203859 .error-icon{fill:#552222;}#mermaid-1736145203859 .error-text{fill:#552222;stroke:#552222;}#mermaid-1736145203859 .edge-thickness-normal{stroke-width:2px;}#mermaid-1736145203859 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1736145203859 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1736145203859 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1736145203859 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1736145203859 .marker{fill:#333333;stroke:#333333;}#mermaid-1736145203859 .marker.cross{stroke:#333333;}#mermaid-1736145203859 svg{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:16px;}#mermaid-1736145203859 .label{font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;color:#333;}#mermaid-1736145203859 .cluster-label text{fill:#333;}#mermaid-1736145203859 .cluster-label span{color:#333;}#mermaid-1736145203859 .label text,#mermaid-1736145203859 span{fill:#333;color:#333;}#mermaid-1736145203859 .node rect,#mermaid-1736145203859 .node circle,#mermaid-1736145203859 .node ellipse,#mermaid-1736145203859 .node polygon,#mermaid-1736145203859 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1736145203859 .node .label{text-align:center;}#mermaid-1736145203859 .node.clickable{cursor:pointer;}#mermaid-1736145203859 .arrowheadPath{fill:#333333;}#mermaid-1736145203859 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1736145203859 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1736145203859 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1736145203859 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1736145203859 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1736145203859 .cluster text{fill:#333;}#mermaid-1736145203859 .cluster span{color:#333;}#mermaid-1736145203859 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1736145203859 :root{--mermaid-font-family:&quot;trebuchet ms&quot;,verdana,arial,sans-serif;}</style><g transform="translate(0, 0)"><g class="output"><g class="clusters"><g style="opacity:1" transform="translate(738.6640625,150)" id="flowchart-VM-30" class="cluster"><rect y="-142" x="-256.3203125" height="284" width="512.640625"></rect><g id="mermaid-1736145203859Text" transform="translate(0, -128)" class="label"><g transform="translate(-12,-9)"><foreignObject height="18" width="24"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml">VM</div></foreignObject></g></g></g></g><g class="edgePaths"><g style="opacity:1" id="L-c-DNS" class="edgePath LS-c LE-DNS"><path style="fill:none" marker-end="url(#arrowhead39)" d="M65.359375,150L85.53125,150C105.703125,150,146.046875,150,186.390625,150C226.734375,150,267.078125,150,287.25,150L307.421875,150" class="path"></path><defs><marker orient="auto" markerHeight="6" markerWidth="8" markerUnits="strokeWidth" refY="5" refX="9" viewBox="0 0 10 10" id="arrowhead39"><path style="stroke-width:1;stroke-dasharray:1, 0" class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs></g><g style="opacity:1" id="L-DNS-n" class="edgePath LS-DNS LE-n"><path style="fill:none" marker-end="url(#arrowhead40)" d="M361.203125,150L371.2981770833333,150C381.3932291666667,150,401.5833333333333,150,421.7734375,150C441.9635416666667,150,462.1536458333333,150,476.4153645833333,150C490.6770833333333,150,499.0104166666667,150,503.1770833333333,150L507.34375,150" class="path"></path><defs><marker orient="auto" markerHeight="6" markerWidth="8" markerUnits="strokeWidth" refY="5" refX="9" viewBox="0 0 10 10" id="arrowhead40"><path style="stroke-width:1;stroke-dasharray:1, 0" class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs></g><g style="opacity:1" id="L-n-uk" class="edgePath LS-n LE-uk"><path style="fill:none" marker-end="url(#arrowhead41)" d="M612.6120383522727,169L630.4358132102274,180.5C648.2595880681819,192,683.907137784091,215,711.8259647253789,226.5C739.7447916666666,238,759.9348958333334,238,770.0299479166666,238L780.125,238" class="path"></path><defs><marker orient="auto" markerHeight="6" markerWidth="8" markerUnits="strokeWidth" refY="5" refX="9" viewBox="0 0 10 10" id="arrowhead41"><path style="stroke-width:1;stroke-dasharray:1, 0" class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs></g><g style="opacity:1" id="L-n-a" class="edgePath LS-n LE-a"><path style="fill:none" marker-end="url(#arrowhead42)" d="M612.6120383522727,131L630.4358132102274,119.5C648.2595880681819,108,683.907137784091,85,715.9014855587121,73.5C747.8958333333334,62,776.2369791666666,62,790.4075520833334,62L804.578125,62" class="path"></path><defs><marker orient="auto" markerHeight="6" markerWidth="8" markerUnits="strokeWidth" refY="5" refX="9" viewBox="0 0 10 10" id="arrowhead42"><path style="stroke-width:1;stroke-dasharray:1, 0" class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs></g><g style="opacity:1" id="L-n-j" class="edgePath LS-n LE-j"><path style="fill:none" marker-end="url(#arrowhead43)" d="M658.984375,150L669.0794270833334,150C679.1744791666666,150,699.3645833333334,150,723.2591145833334,150C747.1536458333334,150,774.7526041666666,150,788.5520833333334,150L802.3515625,150" class="path"></path><defs><marker orient="auto" markerHeight="6" markerWidth="8" markerUnits="strokeWidth" refY="5" refX="9" viewBox="0 0 10 10" id="arrowhead43"><path style="stroke-width:1;stroke-dasharray:1, 0" class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs></g></g><g class="edgeLabels"><g style="opacity:1" transform="translate(186.390625,150)" class="edgeLabel"><g class="label" transform="translate(-96.03125,-9)"><rect height="18" width="192.0625" ry="0" rx="0"></rect><foreignObject height="18" width="192.0625"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel L-LS-c&#x27; L-LE-DNS" id="L-L-c-DNS">1. uptime.my-domains.com</span></div></foreignObject></g></g><g style="opacity:1" transform="translate(421.7734375,150)" class="edgeLabel"><g class="label" transform="translate(-35.5703125,-9)"><rect height="18" width="71.140625" ry="0" rx="0"></rect><foreignObject height="18" width="71.140625"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel L-LS-DNS&#x27; L-LE-n" id="L-L-DNS-n">2. forward</span></div></foreignObject></g></g><g style="opacity:1" transform="translate(719.5546875,238)" class="edgeLabel"><g class="label" transform="translate(-35.5703125,-9)"><rect height="18" width="71.140625" ry="0" rx="0"></rect><foreignObject height="18" width="71.140625"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel L-LS-n&#x27; L-LE-uk" id="L-L-n-uk">3. forward</span></div></foreignObject></g></g><g style="opacity:1" transform="" class="edgeLabel"><g class="label" transform="translate(0,0)"><rect height="0" width="0" ry="0" rx="0"></rect><foreignObject height="0" width="0"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel L-LS-n&#x27; L-LE-a" id="L-L-n-a"></span></div></foreignObject></g></g><g style="opacity:1" transform="" class="edgeLabel"><g class="label" transform="translate(0,0)"><rect height="0" width="0" ry="0" rx="0"></rect><foreignObject height="0" width="0"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel L-LS-n&#x27; L-LE-j" id="L-L-n-j"></span></div></foreignObject></g></g></g><g class="nodes"><g style="opacity:1" transform="translate(583.1640625,150)" id="flowchart-n-15" class="node default"><rect class="label-container" height="38" width="151.640625" y="-19" x="-75.8203125" ry="0" rx="0"></rect><g transform="translate(0,0)" class="label"><g transform="translate(-65.8203125,-9)"><foreignObject height="18" width="131.640625"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml">Nginx (on 80, 443)</div></foreignObject></g></g></g><g style="opacity:1" transform="translate(875.0546875,62)" id="flowchart-a-16" class="node default"><rect class="label-container" height="38" width="140.953125" y="-19" x="-70.4765625" ry="0" rx="0"></rect><g transform="translate(0,0)" class="label"><g transform="translate(-60.4765625,-9)"><foreignObject height="18" width="120.953125"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml">Airflow (on 8080)</div></foreignObject></g></g></g><g style="opacity:1" transform="translate(875.0546875,150)" id="flowchart-j-17" class="node default"><rect class="label-container" height="38" width="145.40625" y="-19" x="-72.703125" ry="0" rx="0"></rect><g transform="translate(0,0)" class="label"><g transform="translate(-62.703125,-9)"><foreignObject height="18" width="125.40625"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml">Jupyter (on 8888)</div></foreignObject></g></g></g><g style="opacity:1" transform="translate(875.0546875,238)" id="flowchart-uk-18" class="node default"><rect class="label-container" height="38" width="189.859375" y="-19" x="-94.9296875" ry="0" rx="0"></rect><g transform="translate(0,0)" class="label"><g transform="translate(-84.9296875,-9)"><foreignObject height="18" width="169.859375"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml">Uptime Kuma (on 3001)</div></foreignObject></g></g></g><g style="opacity:1" transform="translate(36.6796875,150)" id="flowchart-c-19" class="node default"><rect class="label-container" height="38" width="57.359375" y="-19" x="-28.6796875" ry="0" rx="0"></rect><g transform="translate(0,0)" class="label"><g transform="translate(-18.6796875,-9)"><foreignObject height="18" width="37.359375"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml">client</div></foreignObject></g></g></g><g style="opacity:1" transform="translate(334.3125,150)" id="flowchart-DNS-21" class="node default"><rect class="label-container" height="38" width="53.78125" y="-19" x="-26.890625" ry="0" rx="0"></rect><g transform="translate(0,0)" class="label"><g transform="translate(-16.890625,-9)"><foreignObject height="18" width="33.78125"><div style="display:inline-block;white-space:nowrap" xmlns="http://www.w3.org/1999/xhtml">DNS</div></foreignObject></g></g></g></g></g></g></svg></div><h2 id="작업-과정" style="position:relative"><a href="#%EC%9E%91%EC%97%85-%EA%B3%BC%EC%A0%95" aria-label="작업 과정 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>작업 과정</h2><h3 id="도메인-구매" style="position:relative"><a href="#%EB%8F%84%EB%A9%94%EC%9D%B8-%EA%B5%AC%EB%A7%A4" aria-label="도메인 구매 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>도메인 구매</h3><p>먼저 다음처럼 <a href="https://cloud.google.com/domains/docs/overview?hl=ko">GCP Cloud Domains</a>에서 도메인을 구매했다.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:22.2972972972973%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjElEQVQY05WQbQvCMAyE+/9/qCva1K3Z+pJ0O0l1IvhFDx4CIdwlccwMIkIIAUQnhGg9mlGqwHQcx0+4GCO896i1orU2an3XHX3HX3K22bquYE5IaYGKoPf+QiHSUEoZATZnodu2DVT1C3fxE673gHnJmG6MlIwE1Q4RGSZ2hb3GLnmGM3LOI8RmPg0fX5I3qzDIWy0AAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="1" title="1" src="/blog/static/041f436d54abbbe6da1f942498655a88/fcda8/1.png" srcSet="/blog/static/041f436d54abbbe6da1f942498655a88/12f09/1.png 148w,/blog/static/041f436d54abbbe6da1f942498655a88/e4a3f/1.png 295w,/blog/static/041f436d54abbbe6da1f942498655a88/fcda8/1.png 590w,/blog/static/041f436d54abbbe6da1f942498655a88/efc66/1.png 885w,/blog/static/041f436d54abbbe6da1f942498655a88/c83ae/1.png 1180w,/blog/static/041f436d54abbbe6da1f942498655a88/29114/1.png 1920w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span>
<em>이미지에서 도메인 이름은 가렸다.</em></p><p>연 12달러! 생각보다 얼마 안하네.
도메인 따라 가격 차이가 조금 있긴 한데, 대부분 이쯤 하는거 같다.</p><p>상태가 <code class="language-text">Active</code> 들어온 거 보고 바로 <code class="language-text">nslookup</code> 으로 확인해봤다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">nslookup</span> my-domains.com

Server:		<span class="token number">1.214</span>.68.2
Address:	<span class="token number">1.214</span>.68.2<span class="token comment">#53</span>

Non-authoritative answer:
Name:	my-domain.com
Address: <span class="token number">123.123</span>.123.123</code></pre></div><p>도메인에 붙여둔 VM IP가 잘 나온다.</p><p>GCP에서 작년에 Cloud Domains를 매각했다고 해서 GCP에서 도메인 구매가 안될 줄 알았는데, 아직까지는 잘 되는거 같다.</p><h3 id="https에서-쓸-인증서-발급받기" style="position:relative"><a href="#https%EC%97%90%EC%84%9C-%EC%93%B8-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89%EB%B0%9B%EA%B8%B0" aria-label="https에서 쓸 인증서 발급받기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTTPS에서 쓸 인증서 발급받기</h3><p>이제 HTTPS에서 사용될 인증서를 발급받아야 한다.</p><p>GCP에서 인증서 발급해주는 서비스가 있을거 같았는데... 없는거 같다.
<a href="https://cloud.google.com/load-balancing/docs/ssl-certificates/google-managed-certs?hl=ko">하나</a> 있긴 한데 이걸 쓰려면 GCP 로드밸런서를 추가로 써야한다.
로드밸런서 쓰면 최소 VM 비용 하나 더 나가니까, 이건 안쓰기로 했다.</p><p>검색해보니, 나처럼 VM에 직접 Nginx 띄우고 인증서 붙이는 사람들은 <a href="https://certbot.eff.org/">Certbot</a>을 많이 쓰는거 같았다.
특히 <a href="https://velog.io/@hannah3406/GCPnginx-SSL-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89%EB%B0%9B%EC%95%84-%EC%A7%81%EC%A0%91-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%84%9C-%EC%84%A4%EC%A0%95%ED%95%B4%EC%A3%BC%EA%B8%B0">이 블로그 글</a> 보니까 별로 어렵지 않은 느낌이 확 왔다.
공식 문서에도 설치 및 실행 과정이 매우 자세히 나와있어서, 이걸 사용해보기로 했다.</p><p>먼저 어떤 버전을 설치할 지 알기 위해 VM에 접속한 후 OS 버전 확인.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">cat</span> /etc/issue

Debian GNU/Linux <span class="token number">11</span> <span class="token punctuation">\</span>n <span class="token punctuation">\</span>l</code></pre></div><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:57.432432432432435%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2UlEQVQoz41RPWvbUBTVkGLTwYYQSjOVkkIhP6U/oUN/RJOlXby2QwYnW71Vll6ps4RuHrxaRoNtWeBgsGRbJgqyJSEbJEV6erdcfZimtG4PHO7Vu+eed58u9+Jp+e2rZ4e3p6evpZOTl/Lz42P58OhIrlQqe1mtVnd5qVSSnhwc3JbL5ffc14uLDz94Hr5fX8M3noerT5+h2WiAKIogiGIa91EQBOB5HoRmE+r1+hfOtKwzyBACAF3d3VGIIor570yS5I/neS+4rnvJ6Zp27joOLA0jNk2Tmff34HoeJEkClNL/YhzHMWMMZrPZFadp2jkeRlEURw8PLAxDFKQjo+hfQA1jLG1YLBaZYV6LszoDwzBSTqdTWC6XoGsaBJ4H8WYLW8eBwHVhY1kQBAGwrOmxYXELy1DcuncqNEPC3wyLCfMpd3G1WjHHcdh6vWa2bTNKKSt0v+gfGZ7lE4W4RQRjLN0ewvM86vs+3Wy21LZtGoYhLXQIzLE3N6xzuq5/LJ6Cm/V9HyzLgvl8vns2RqwVvwLz4htjAcMwGly73X6jKMrNcDgU+v0+GY/HpNVqkVqtRiaTCVEUhXS7XdLr9YiqqiklSSKyLJPRaEQGgwHBXlVVbzqdzruf+d/vPdnINH8AAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="2" title="2" src="/blog/static/ac7327f6dfa07db2829ce0a684e93464/fcda8/2.png" srcSet="/blog/static/ac7327f6dfa07db2829ce0a684e93464/12f09/2.png 148w,/blog/static/ac7327f6dfa07db2829ce0a684e93464/e4a3f/2.png 295w,/blog/static/ac7327f6dfa07db2829ce0a684e93464/fcda8/2.png 590w,/blog/static/ac7327f6dfa07db2829ce0a684e93464/efc66/2.png 885w,/blog/static/ac7327f6dfa07db2829ce0a684e93464/c83ae/2.png 1180w,/blog/static/ac7327f6dfa07db2829ce0a684e93464/e57e0/2.png 4064w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>위처럼 <code class="language-text">nginx</code> 와 <code class="language-text">debian</code> 을 선택하면 아래처럼 설치 방법이 나온다.
나는 서브 도메인을 사용할거라 <code class="language-text">wildcard</code> 옵션을 선택했다.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:57.432432432432435%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACC0lEQVQoz31RTY/SUBTtz4GYEGQwgxrMrIzOhpUuNPFHOLPRf6HudG26xoULTFhQSCZTIEAgmZHQR0uN0IbaTj9o6XvvmvuGjmSMnuTk3N5733n3vkqlwp0X1UcPL2rPXp49rT1Xq0fHavVxTX1w9EQtlg7Vu+WKWjw4FCyV79/ExYOKWrpXUcvlslooFM5yudxFPp9/LSmK8kbXdfixtGGu6fDty1fQhmMg8wVoRIfpdAYamQtefp/CTCOCmjYHnczBMAwghADRCHQ6nY+SaZoncI0YAGiabikq50yobVvU81z6y3GoZa0o51zkbxHPwmq1ei/NZrNTxhgwxlPGGOecAxKRJAk4jgOe50EYhuB5V7DdboFSKpjulDGWYr+u6x8kTdNOdwZpmqY8CAKwLAuLWTNQmt5cgpoZCtNU1IShYRh/DDGJhliYTCZQr9chA06I3P+OokjEaPpPQ0opz1aN41g0I3Bt0zRFjIoX+r7/f8PrlSl3XZev12tu2zb3PA/H5nEcCyZJIuqO4+DT4HtzHOK24cluwphSSjebDY2iSDCLfd8XDIKAhmEocqhJklAxBefxzvCdRAh5C3twrwL4uVyC67riwXF9/LMYo+4zq2VYLBafpEajcTwajerD4fDzYDCQ1fNzud1uy4qiyK1WS1babbnb7cq9Xu8v9vt9oXh2PB7Xm83mq9+aaQK5Qb2uWAAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="3" title="3" src="/blog/static/323ddf61381c2eef52ac9911106ed457/fcda8/3.png" srcSet="/blog/static/323ddf61381c2eef52ac9911106ed457/12f09/3.png 148w,/blog/static/323ddf61381c2eef52ac9911106ed457/e4a3f/3.png 295w,/blog/static/323ddf61381c2eef52ac9911106ed457/fcda8/3.png 590w,/blog/static/323ddf61381c2eef52ac9911106ed457/efc66/3.png 885w,/blog/static/323ddf61381c2eef52ac9911106ed457/c83ae/3.png 1180w,/blog/static/323ddf61381c2eef52ac9911106ed457/e57e0/3.png 4064w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>이 설명 따라서 설치하면 된다.</p><p>먼저 certbot 설치.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">apt</span> update
$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> snapd
$ <span class="token function">sudo</span> snap <span class="token function">install</span> --classic certbot
$ <span class="token function">sudo</span> <span class="token function">ln</span> -s /snap/bin/certbot /usr/bin/certbot</code></pre></div><p>또 나는 GCP Cloud Domains를 사용 중이기 때문에, <a href="https://certbot-dns-google.readthedocs.io/en/stable/">공식 문서</a>를 참고해서 다음처럼 <code class="language-text">google</code> 플러그인 설치.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">sudo</span> snap <span class="token builtin class-name">set</span> certbot trust-plugin-with-root<span class="token operator">=</span>ok
$ <span class="token function">sudo</span> snap <span class="token function">install</span> certbot-dns-google</code></pre></div><p>이제 certbot 설치는 완료되었고, 이 certbot이 사용할 GCP 서비스 계정을 하나 만들어 주어야한다.</p><p>GCP 웹 콘솔에서 <code class="language-text">certbot</code> 이름으로 서비스 계정 하나 만들고, <code class="language-text">DNS Administrator</code> 역할을 부여했다.
그리고 certbot이 사용할 수 있도록 JSON 키 발급 받아서 VM에 올려두었다.</p><p>이제 다음처럼 <code class="language-text">certbot</code> 명령어로 인증서를 발급받는다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">sudo</span> certbot certonly <span class="token punctuation">\</span>
    --dns-google <span class="token punctuation">\</span>
    --dns-google-credentials /home/user/nginx/certbot-credentials.json <span class="token punctuation">\</span>
    -d <span class="token string">&quot;*.my-domains.com&quot;</span> <span class="token punctuation">\</span>
    -d my-domains.com <span class="token punctuation">\</span>
    -i nginx</code></pre></div><p><code class="language-text">/home/user/nginx/certbot-credentials.json</code> 는 방금 만든 GCP 서비스 계정의 JSON 키 파일 경로다.<br/>
<code class="language-text">-d</code> 옵션으로 여러 도메인을 지정할 수 있는데, 나는 <code class="language-text">*.my-domains.com</code> 와 <code class="language-text">my-domains.com</code> 두개를 지정했다.<br/>
<code class="language-text">-i</code> 옵션은 Nginx를 사용하고 있기 때문에 <code class="language-text">nginx</code> 로 지정했다.</p><p>실행 결과를 통해 다음과 같은 경로에 인증서가 저장되었다는 걸 볼 수 있다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">Certificate is saved at: /etc/letsencrypt/live/my-domains.com/fullchain.pem
Key is saved at:         /etc/letsencrypt/live/my-domains.com/privkey.pem</code></pre></div><p>결국 <a href="https://letsencrypt.org/ko/">Let&#x27;s Encrypt</a>에서 인증서를 발급받는 건데, 발급받기 쉽게 certbot이 한번 래핑해주는 거 같다.</p><p>위 인증서 파일은 다음처럼 확인할 수 있다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">sudo</span> openssl x509 -text -in /etc/letsencrypt/live/my-domains.com/fullchain.pem

Certificate:
<span class="token punctuation">..</span>. <span class="token punctuation">(</span>생략함<span class="token punctuation">)</span>
-----BEGIN CERTIFICATE-----
<span class="token punctuation">..</span>. <span class="token punctuation">(</span>생략함<span class="token punctuation">)</span>
-----END CERTIFICATE-----</code></pre></div><h3 id="nginx-설정-및-배포" style="position:relative"><a href="#nginx-%EC%84%A4%EC%A0%95-%EB%B0%8F-%EB%B0%B0%ED%8F%AC" aria-label="nginx 설정 및 배포 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Nginx 설정 및 배포</h3><p>이제 Nginx 설정 파일을 작성하고 배포 해보자.</p><p>설정 파일은 ChatGPT 4.0 도움을 받았다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">cat</span> nginx.conf

events <span class="token punctuation">{</span>
    worker_connections <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    <span class="token comment"># SSL 설정 및 기타 전역 HTTP 설정</span>
    ssl_session_cache shared:SSL:1m<span class="token punctuation">;</span>
    ssl_session_timeout  10m<span class="token punctuation">;</span>
    ssl_ciphers HIGH:<span class="token operator">!</span>aNULL:<span class="token operator">!</span>MD5<span class="token punctuation">;</span>
    ssl_prefer_server_ciphers on<span class="token punctuation">;</span>

    <span class="token comment"># Uptime Monitor: uptime.my-domains.com를 3001 포트로 프록시</span>
    server <span class="token punctuation">{</span>
        listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>
        server_name uptime.my-domains.com<span class="token punctuation">;</span>

        ssl_certificate /etc/letsencrypt/live/my-domains.com/fullchain.pem<span class="token punctuation">;</span>
        ssl_certificate_key /etc/letsencrypt/live/my-domains.com/privkey.pem<span class="token punctuation">;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass http://localhost:3001<span class="token punctuation">;</span>
            proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
            proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
            proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
            proxy_set_header X-Forwarded-Proto <span class="token variable">$scheme</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># HTTP 요청을 HTTPS로 리디렉트</span>
    server <span class="token punctuation">{</span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>
        server_name uptime.my-domains.com<span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p><code class="language-text">server</code> 블록 내에 <code class="language-text">ssl_certificate</code> 와  <code class="language-text">ssl_certificate_key</code> 를 통해 방금 발급받은 인증서를 지정했다.
이후에 추가할 백엔드 서비스가 또 생기면 <code class="language-text">server</code> 블록을 하나 더 추가하면 된다.</p><p>이제 도커로 Nginx를 배포하자.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">docker</span> run --name nginx -d <span class="token punctuation">\</span>
  --network<span class="token operator">=</span><span class="token string">&quot;host&quot;</span> <span class="token punctuation">\</span>
  -v /home/user/nginx/nginx.conf:/etc/nginx/nginx.conf <span class="token punctuation">\</span>
  -v /etc/letsencrypt:/etc/letsencrypt:ro <span class="token punctuation">\</span>
  nginx:1.24.0</code></pre></div><p><code class="language-text">--network=&quot;host&quot;</code> 옵션으로 Nginx가 호스트 네트워크를 사용해야, 기존에 배포되어 있는 다른 컨테이너 네트워크에 포워딩할 수가 있다.
이 옵션을 안넣어주면, <code class="language-text">nginx</code> 컨테이너가 다른 컨테이너 네트워크에 접근할 수가 없다.
호스트 네트워크를 사용한다는게 보안적으로 조금 찜찜하긴 하지만, 일단은 이렇게 하기로 했다.</p><p><code class="language-text">-v /etc/letsencrypt:/etc/letsencrypt:ro</code> 옵션으로 인증서 파일을 Nginx 컨테이너에 마운트했다.</p><h3 id="서브-도메인-레코드-추가" style="position:relative"><a href="#%EC%84%9C%EB%B8%8C-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%A0%88%EC%BD%94%EB%93%9C-%EC%B6%94%EA%B0%80" aria-label="서브 도메인 레코드 추가 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>서브 도메인 레코드 추가</h3><p>마지막으로 <code class="language-text">uptime.my-domains.com</code> 로 접근하면 해당 VM으로 접속할 수 있도록 DNS에 A 레코드를 추가하자.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:27.7027027027027%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1UlEQVQY031QXW8CMQzr//+HewTBjp2027X0K0lbTy4bDwiIZFVKUju2O62CkBqsDaj1idYGWmtQVZgZev/vd4wx3sJtXnHNDT9BEXNHSB1FBmqtyDmjlDKJfGyo0sEaAy/LfZ5P2LZtfjYTxGuAqiCldO+HEObMVCGi8/JHiMiEWy4ey5pxWAou3wW1FqjZXCLRvu/zZQS0/wyc0Ql33Xr2WA4RtF5qm3mNP08k5YVUvll9nR2JY4xw65Zw/BJ8HDNSoZrdSZkjr6N9FvvPwF2Keu/xC71s1Tw7VGL+AAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="4" title="4" src="/blog/static/90bf00740d484584185cc35c1ae05bdc/fcda8/4.png" srcSet="/blog/static/90bf00740d484584185cc35c1ae05bdc/12f09/4.png 148w,/blog/static/90bf00740d484584185cc35c1ae05bdc/e4a3f/4.png 295w,/blog/static/90bf00740d484584185cc35c1ae05bdc/fcda8/4.png 590w,/blog/static/90bf00740d484584185cc35c1ae05bdc/efc66/4.png 885w,/blog/static/90bf00740d484584185cc35c1ae05bdc/c83ae/4.png 1180w,/blog/static/90bf00740d484584185cc35c1ae05bdc/beade/4.png 2266w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>A 레코드의 IP 값은 모두 같은 VM의 IP 값으로 지정했다.
이제 위 도메인으로 요청하면, 모두 같은 VM 내 Nginx가 이를 처리해서 적당한 서비스로 포워딩해줄 것이다.</p><h2 id="결과" style="position:relative"><a href="#%EA%B2%B0%EA%B3%BC" aria-label="결과 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>결과</h2><p>이제 <code class="language-text">https://uptime.my-domains.com</code> 로 접속하면, 다음과 같이 HTTPS가 적용되어 잘 동작하는 것을 확인할 수 있다.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:57.432432432432435%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWklEQVQoz52S22rCQBCGg7Sb3dnN5mBabYyJ9igFLT1ApfbCB/PCIPjCXlRMyJQ9SEMohXrxZWd3Zv79M6xzN5lsp8+v+PI2x4fHGebX9zjMb3E4+pvMkuY32B/kGPcGGF8mWyfqJeveVYZht78HEVZcdivRxo8rL7jQq/gtL+O958coZLR2XJcXrsuRMlEykDUDD5tw5iPpcDxzKLpEIAOJrRrVU+qYeYUDXBbAfQTul8D92sYa6noY5SmOPp8w+5hiOEyQUg+bNbZH9arLCkd97KYEkDWARI0WFBiNU8yWM8yXM+yOU32mhY51+q9kQ9A6ZC2HTK3CuCQdptFiwuYaDtnRIdeCfgEiQCaCEkRQq/iIEQ0QvNDQPPuhtr0qZx2azYGZ207hYDTMDDfWetUa9n+o7Aw3DgNvZZ6C3DGQXyeys89p5ZwTmhBCF4TQd0Lo/ERU70JpfQNEaeVQ41vN1AAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="5" title="5" src="/blog/static/8a57f07707e170064e28b40ec88f7e07/fcda8/5.png" srcSet="/blog/static/8a57f07707e170064e28b40ec88f7e07/12f09/5.png 148w,/blog/static/8a57f07707e170064e28b40ec88f7e07/e4a3f/5.png 295w,/blog/static/8a57f07707e170064e28b40ec88f7e07/fcda8/5.png 590w,/blog/static/8a57f07707e170064e28b40ec88f7e07/efc66/5.png 885w,/blog/static/8a57f07707e170064e28b40ec88f7e07/c83ae/5.png 1180w,/blog/static/8a57f07707e170064e28b40ec88f7e07/29114/5.png 1920w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>Nginx 설정 파일에 작성해둔 포워딩 규칙대로 나머지 서브 도메인에 대해서도 잘 동작하는 것을 확인했다.</p><p>이제, 처음 목표한대로 HTTPS가 적용된 서브 도메인으로 접속할 수 있게 되었다.</p></div><div id="disqus_thread"></div></main><footer><ul class="external-links"><li><a href="https://www.facebook.com/heumsi/"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.8 90.69 226.4 209.3 245V327.7h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.3 482.4 504 379.8 504 256z"></path></svg></a></li><li><a href="https://www.linkedin.com/in/siheum-jeon-04222a1b3/"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li><a href="https://github.com/heumsi/"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li><li><a href="https://bit.ly/3zAT8Ab"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file-lines" class="svg-inline--fa fa-file-lines " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M256 0v128h128L256 0zM224 128L224 0H48C21.49 0 0 21.49 0 48v416C0 490.5 21.49 512 48 512h288c26.51 0 48-21.49 48-48V160h-127.1C238.3 160 224 145.7 224 128zM272 416h-160C103.2 416 96 408.8 96 400C96 391.2 103.2 384 112 384h160c8.836 0 16 7.162 16 16C288 408.8 280.8 416 272 416zM272 352h-160C103.2 352 96 344.8 96 336C96 327.2 103.2 320 112 320h160c8.836 0 16 7.162 16 16C288 344.8 280.8 352 272 352zM288 272C288 280.8 280.8 288 272 288h-160C103.2 288 96 280.8 96 272C96 263.2 103.2 256 112 256h160C280.8 256 288 263.2 288 272z"></path></svg></a></li></ul><p class="copy-right">@ heumsi</p></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/vm-nginx-certbot/";window.___webpackCompilationHash="9023d6fb65f6071942db";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4aa291e7e6681714b3e8.js"],"app":["/app-c321c5efdf12999a1dd7.js"],"component---src-components-templates-log-js":["/component---src-components-templates-log-js-8be2b192cec9967ef4ea.js"],"component---src-components-templates-post-js":["/component---src-components-templates-post-js-d80014afc9ad124b5ee3.js"],"component---src-pages-404-js":["/component---src-pages-404-js-5ed0d86fb0763a04a4b4.js"],"component---src-pages-index-js":["/component---src-pages-index-js-67136b30be5717c21631.js"],"component---src-pages-logs-index-js":["/component---src-pages-logs-index-js-bf19e8f568991d11bb86.js"],"component---src-pages-posts-index-js":["/component---src-pages-posts-index-js-2779df3cf8aef25ec545.js"]};/*]]>*/</script><script src="/blog/polyfill-4aa291e7e6681714b3e8.js" nomodule=""></script><script src="/blog/app-c321c5efdf12999a1dd7.js" async=""></script><script src="/blog/framework-c9b92197cbae3c33e091.js" async=""></script><script src="/blog/webpack-runtime-d16735df36b4c0712223.js" async=""></script></body></html>